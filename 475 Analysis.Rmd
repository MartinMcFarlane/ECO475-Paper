---
title: "475 Analysis"
output: html_document
date: "2024-01-31"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Setup

#load packages
library(quantmod)
library(expss)
library(vtable)
library(xts)
library(tidyr)
library(tidyverse)
library(dplyr)


```

```{r}
# Load primary dataset
housing.raw <- read.csv("Data/housing_indicators_micro.csv")
cols <- c("Census.year..2.", "GEO", "DGUID", "Housing.indicators..9.",
          "Tenure..4.", "VALUE") # cols to keep
housing <- housing.raw[,cols] 
names(housing) <- c("Year", "GEO", "DGUID", "Indicator", "Tenure", "VALUE")

```

```{r}
housing.w <- pivot_wider(housing, id_cols=c("Year", "GEO", "DGUID","Tenure"),
                         names_from="Indicator", values_from="VALUE")
cols <- c("Year", "GEO", "DGUID", "Tenure", "tot.hh", "inadq.pc", "unsuit.pc",
          "unafford.pc", "core.nd", "core.nd.pc", "inadq", "unsuit", "unafford")
names(housing.w) <- cols

housing.w$Tenure[housing.w$Tenure == "Dwelling provided by the local government, First Nation or Indian band"] <- "Government provided"

housing.w$Tenure[housing.w$Tenure == "Total - Tenure"] <- "Total"

# drop government provided tenure values - not relevant
housing.w <- housing.w %>% filter(Tenure!="Government provided")

# replace NAs with zeros
housing.w <- housing.w %>% replace_na(list(tot.hh=0, inadq.pc=0.0, unsuit.pc=0.0, unafford.pc=0.0,
                              core.nd=0, core.nd.pc=0.0, inadq=0, unsuit=0, unafford=0))

# drop subdivisions where tot.hh for total tenure == 0
housing.total <- filter(housing.w, Tenure == "Total" )
# filter df by Tenure == Tenure total
for (i in 1:nrow(housing.total)) {
  if (housing.total[i, "tot.hh"] == 0) {
    yr <- as.numeric(housing.total[i, "Year"]) # if tot.hh == 0, collect year and DGUID
    geo_id <- as.character(housing.total[i, "DGUID"])
    
    # in orig df, drop observation if year and DGUID match
    housing.w <- housing.w %>% subset(!(DGUID==geo_id & Year==yr))
  }
}



```

```{r}
# get summary statistics: group by year-tenure type

vars.of.int <- c("tot.hh", "inadq.pc", "unsuit.pc", "unafford.pc", "inadq",
                 "unsuit", "unafford")

stats <- c("mean(x)", "sd(x)", "min(x)", "median(x)", "max(x)")
stats.label <- c("Mean", "Std. Dev.", "Min", "Median", "Max")

sumtable(housing.w, vars=vars.of.int, summ=stats, summ.names=stats.label, group="Tenure", out="latex")
```

```{}
# SCRAP CODE

housing.w <- apply_labels(housing.w,
  tot.hh = "Total Households",
  inadq.pc = "Inadequate Housing (%)",
  inadq = "Inadequate Housing (Count)",
  unsuit.pc = "Unsuitable Housing (%)",
  unsuit = "Unsuitable Housing (Count)",
  unafford.pc = "Unaffordable Housing (%)",
  unafford = "Unaffordable Housing (Count)",
  core.nd.pc = "In Core Housing Need (%)",
  core.nd = "In Core Housing Need (Count)"
)
```

